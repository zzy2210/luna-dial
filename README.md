# Luna Dial 🌙

**Luna Dial** 是一个基于DDD（领域驱动设计）的个人任务与日志管理系统，支持树形结构的任务管理和多维度的时间周期规划。

## ✨ 特性

### 🎯 任务管理
- **树形结构**：支持年 → 季 → 月 → 周 → 日的层级任务组织
- **智能查询**：优化的任务树查询，支持分页和过滤
- **积极状态管理**：完整的任务生命周期（未开始、进行中、已完成、已取消），无"失败"概念
- **每日自评系统**：进行中的任务支持每日努力程度评分，记录每一份付出
- **优先级系统**：支持低、中、高、紧急四个级别
- **标签系统**：灵活的任务标签和图标支持
- **成长记录**：通过分数评估记录个人成长轨迹

### 📝 日志系统
- **多周期支持**：日志、周记、月报、季报、年度总结
- **内容管理**：富文本内容和时间段管理
- **个性化**：自定义图标和标签
- **时间过滤**：按时间范围和类型精确查询

### 📊 计划视图
- **聚合展示**：任务和日志的统一视图
- **统计分析**：按时间维度的分数统计和分组
- **多维过滤**：支持按类型、状态、时间范围筛选

### 🔐 用户系统
- **安全认证**：基于Session的认证机制
- **用户隔离**：数据完全隔离，支持多用户
- **会话管理**：支持多设备登录和统一登出

## 🏗️ 架构设计

### 技术栈
- **后端**: Go 1.23 + Echo Web框架
- **数据库**: PostgreSQL
- **部署**: Docker + Docker Compose
- **客户端**: 正在使用Rust重构TUI客户端（新分支开发中）

### 项目结构
```
luna-dial/
├── luna_dial_server/          # Go后端服务
│   ├── cmd/                   # 应用入口
│   ├── internal/              # 核心业务逻辑
│   │   ├── biz/              # 业务层（领域逻辑）
│   │   ├── data/             # 数据层（Repository实现）
│   │   ├── service/          # 服务层（HTTP处理器）
│   │   └── server/           # 服务器配置
│   ├── migrations/           # 数据库迁移
│   ├── configs/              # 配置文件
│   └── docs/                 # API文档
├── luna_dial_client/         # [已弃用] Python客户端
└── doc/                      # 项目文档
```

### 设计理念

基于DDD（领域驱动设计）的分层架构：
- **Server层**: 路由注册和请求分发
- **Service层**: HTTP处理和参数验证
- **Biz层**: 核心业务逻辑和领域规则
- **Data层**: 数据持久化和Repository实现

**核心领域对象**：
- **Task（任务）**: 聚合根，管理任务生命周期和子任务
- **Journal（日志）**: 聚合根，管理日志内容和时间周期
- **Plan（计划）**: 值对象，提供任务和日志的聚合视图
- **User（用户）**: 聚合根，管理用户信息和权限

## 🚀 快速开始

### 前置要求
- Docker & Docker Compose v2
- Git

### 1. 克隆项目
```bash
git clone https://github.com/zzy2210/luna-dial.git
cd luna-dial/luna_dial_server
```

### 2. 启动服务
```bash
# 自动化启动（推荐）
./start.sh

# 或手动启动
docker-compose up -d
```

### 3. 验证服务
```bash
# 健康检查
curl http://localhost:8081/health

# 查看版本
curl http://localhost:8081/version
```

服务将在以下端口启动：
- **API服务**: http://localhost:8081
- **PostgreSQL**: localhost:15432

### 4. 初始化数据库
数据库迁移会在容器启动时自动执行，无需手动操作。

##  API 文档

完整的API文档请参考：[API.md](luna_dial_server/docs/API.md)

主要功能：
- **用户认证**：基于Session的安全认证机制
- **任务管理**：创建、查询、更新任务，支持树形结构和分页
- **日志系统**：多周期日志管理和查询
- **计划视图**：任务和日志的聚合展示
- **数据统计**：按时间维度的成长数据分析

## 🛠️ 开发

### 本地开发环境
```bash
# 安装依赖
go mod download

# 运行测试
go test ./...

# 本地启动（需要先启动PostgreSQL）
go run cmd/main.go
```

### 核心模块说明
- **业务层** (`internal/biz/`): 核心领域逻辑和业务规则
- **数据层** (`internal/data/`): 数据模型和Repository实现
- **服务层** (`internal/service/`): HTTP处理和API接口
- **配置层** (`configs/`): 环境配置和参数管理

## 📊 任务树优化

本项目采用了创新的**混合方案**来优化任务树的查询性能：

### 核心特性
- **数据库冗余字段**: 添加树结构优化字段，提升查询效率
- **业务层树构建**: 在内存中构建完整的树形结构
- **智能查询策略**: 最小化数据库交互次数，支持大规模数据

### 性能优势
- 支持长期大量任务累积的快速查询
- 分页友好的根任务查询
- 高效的整树和子树检索

详细设计请参考：[任务树优化设计文档](luna_dial_server/doc/任务树优化设计文档.md)

## 🎨 设计理念

> **"积极向上，记录成长"**

### 🌟 积极导向原则
- **要积极不要消极**: 系统设计避免消极展示，专注于正面反馈和成长记录
- **无失败概念**: 任务状态不设"失败"，只有"未开始"、"进行中"、"已完成"、"已取消"
- **每日自评机制**: 即使任务未完成，每日的努力程度也值得记录和肯定
- **进步可视化**: 通过分数系统展现每日的努力和进步，而非完成度的缺失

### 📈 成长记录理念
- **"尽量不要隐藏自己的过往"**: 保留个人成长轨迹和历史记录
- **状态管理优于删除**: 推荐将未完成的任务设为"取消"状态，而不是删除
- **数据完整性**: 每一次努力都有价值，都应该被记录和认可
- **持续反馈**: 通过评分机制提供即时的正面反馈，激励持续行动

### ⚖️ 设计平衡
- **简洁与功能平衡**: 在保持系统简洁的同时提供强大功能
- **灵活性与规范性**: 既提供结构化的任务管理，又允许个性化的使用方式

## 🔄 版本历史

### 当前版本特性
- ✅ 积极导向的设计理念实现
- ✅ DDD架构实现
- ✅ 完整的任务树管理
- ✅ 每日自评系统
- ✅ 无消极状态的任务管理
- ✅ 优化的查询性能
- ✅ 分页和过滤支持
- ✅ Docker化部署

### 开发中
- 🚧 Rust TUI客户端（新分支）
- 🔄 移动任务功能的业务逻辑实现
- 📈 更多成长数据可视化功能
- 🎯 积极反馈机制增强

## 🤝 贡献

欢迎提交Issue和Pull Request！

### 开发规范
1. 遵循Go代码规范
2. 添加适当的测试覆盖
3. 更新相关文档
4. 遵循DDD设计原则

### 分支策略
- `main`: 稳定版本
- `feat/*`: 功能开发分支
- `fix/*`: Bug修复分支

## 📄 许可证

本项目采用 **CC BY-NC 4.0** (Creative Commons Attribution-NonCommercial 4.0) 许可证 - 详见[LICENSE](LICENSE)文件

**许可说明**：
- ✅ 自由分享：可以复制、分发和传播本作品
- ✅ 自由改编：可以修改、转换和基于本作品进行创作
- ✅ 适用场景：个人使用、学习、研究、教育等非商业用途
- 🔗 署名要求：使用时需注明原作者和来源
- ❌ 非商业：禁止用于商业目的（如需商业使用请联系作者）

**CC许可证的优势**：国际标准、法律认可、社区广泛接受

## 📞 联系

如有问题或建议，请通过以下方式联系：
- GitHub Issues: [提交问题](https://github.com/zzy2210/luna-dial/issues)
- 项目维护者: [@zzy2210](https://github.com/zzy2210)

---

⭐ 如果这个项目对你有帮助，请给一个Star支持！
